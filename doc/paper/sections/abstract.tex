\begin{abstract}
Strongly consistent systems are easy to reason about but face fundamental
limitations in availability and performance, and weakly consistent systems can
be implemented with very high performance but place a burden on the
application developer to reason about complex interleavings of execution.
Invariant-confluence provides a formal framework for understanding when we can
get the best of both worlds. An invariant-confluent object can be efficiently
replicated with no coordination needed to preserve its invariants.  However,
actually determining whether or not an object is invariant-confluent is
challenging (undecidable). In this paper, we establish conditions under which a
commonly used sufficient condition for invariant confluence is both necessary
and sufficient and use this condition to design (a) a general-purpose
interactive invariant-confluence decision procedure and (b) a novel sufficient
condition which can be checked automatically. We then take a step beyond
invariant-confluence and introduce a generalization of invariant-confluence
called segmented invariant-confluence, which allows us to replicate
non-invariant-confluent objects with a small and tunable amount of
coordination. We implemented our theoretical findings in a prototype called
Lucy and found that our decision procedures can be used to efficiently
determine the invariant-confluence of common invariants including foreign key
constraints and escrow transactions. We also found that segmented
invariant-confluence replication can deliver up to an order of magnitude more
throughput than linearizable replication for low contention workloads and
comparable throughput for medium to high contention workloads.

% Strongly consistent systems are easy to reason about but are slow. Weakly
% consistent systems are fast but hard to reason about. Invariant-confluence
% gives a formal framework to reason about when data can be replicated without
% any coordination needed to maintain invraints, the best of borth worlds.
% However, determining whether an object is invariant-confluent is hard. In
% this paper, we establish conditions under which a commonly used sufficient
% condition for invariant confluence is both necessary and usfficient. We use
% this condition to design a general-purpose interactive decision procedure and
% a novel sufficient condition which can be checked automatically. We then take
% a step beyond invariant-confluence and introduce a generalization of
% invariant-confuluence, called segmented invariant-confluence which allows to
% replicate objects with a minimal amount of coordination that are otherwise
% not invariant-confluent. We implement all this in a system called lucy and
% look at a bunch of stuff.
\end{abstract}
